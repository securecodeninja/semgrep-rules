id: open-redirect
mode: taint
pattern-sources:
    - pattern: $REDIRECTURL
pattern-sinks:
  - patterns:
    - pattern: Redirect($REDIRECTURL)
    - pattern-not-inside: |
        if (IsLocalUrl($REDIRECTURL)) 
        { 
            ... Redirect($REDIRECTURL); 
        }
    - pattern-not-inside: |
        if (Url.IsLocalUrl($REDIRECTURL)) 
        { 
            ... Redirect($REDIRECTURL); 
        }
    - pattern-not-inside: |
        if ($URL.IsLocalUrl($REDIRECTURL)) 
        { 
            ... Redirect($REDIRECTURL); 
        }
message: A query string parameter may contain a URL value that could cause the
  web application to redirect the request to a malicious website controlled by
  an attacker.
metadata:
  category: security
  technology:
    - csharp
  cwe: "CWE-601: URL Redirection to Untrusted Site ('Open Redirect')"
  references:
    - https://cwe.mitre.org/data/definitions/601.html
  owasp: A4:2021 insecure-design
languages:
  - csharp
severity: ERROR
